# eudr-dmi-gil

## What is EUDR-DMI-GIL?

EUDR-DMI-GIL is an authoritative, open implementation of a geospatial data management and evidence-generation system designed to support inspection and due-diligence workflows related to EUDR.

## Abbreviations

- EUDR = European Union Deforestation Regulation
- DMI = Data Management Infrastructure
- GIL = Geospatial Intelligence Layer
- DAO = Decentralized Autonomous Organization (procedural, non-blockchain governance model in this project)
- DT = Digital Twin
- DTE = EUDR DAO Digital Twin Engineer

## Definitions

### DAO (Procedural DAO)

In this project, “DAO” refers to a procedural, evidence-driven governance workflow for proposing, reviewing, and implementing changes. It does not refer to a blockchain-based DAO.

The intent is to make governance artefacts auditable and transparent, with deterministic outputs that can be reproduced and reviewed.

### Digital Twin

The Digital Twin is a public, inspectable, versioned representation of system state, evidence mappings, and generated outputs.

It is not a live “real-time twin” by default. Updates are published through controlled releases.

## Repository Role (Authoritative)

This repository is the authoritative source for:

- code
- evidence contracts and schemas
- deterministic data-processing pipelines
- reproducible report generation

## Current Digital Twin Update Model (Human-in-the-loop)

Current updates follow a controlled feedback loop:

1) Stakeholders submit questions, evidence gaps, or change proposals via portal templates  
2) Developers implement approved changes in this authoritative repository  
3) Deterministic pipelines regenerate evidence artefacts and views  
4) The portal republishes the updated inspectable state  

All changes are expected to be versioned, reproducible, and reviewable.

## Roles, Authority, and Governance Loop

This repository is the authoritative implementation that executes the governance workflow and generates deterministic outputs.

**Roles**

- **EUDR DAO Digital Twin Engineer (AI inspection/proposal engine)**: Inspects published outputs, drafts DAO proposals, and prepares structured questions for stakeholder review. It does not publish authoritative changes by itself.
- **eudr-dmi-gil-digital-twin**: Public DT portal with non-authoritative, example outputs and DAO templates for inspection and governance.
- **eudr-dmi-gil**: Authoritative implementation with deterministic pipelines, tests, and report generation.

### Proposal lifecycle

1) Inspect published DT outputs
2) Q/A and evidence gap discovery
3) Stakeholder confirmation
4) Versioned proposal in Git
5) Developer review
6) Implementation in eudr-dmi-gil
7) Regenerate deterministic outputs
8) Publish DT updates

### Public vs Private Outputs

- This DT repository contains only public example outputs and governance artefacts.
- Client AOI reports are generated by eudr-dmi-gil and stored privately on server/MinIO; they are never committed to the DT repository.

### Publication boundaries (authoritative vs portal)

- `audit/evidence/**` is historical, immutable, and **not** directly published.
- `out/site_bundle/**` is the **only** publication artifact.
- The Digital Twin consumes **only** `site_bundle` outputs.

Flow (deterministic, human-in-the-loop):

1) Generate evidence bundles → `audit/evidence/**` (immutable)
2) Export site bundle → `out/site_bundle/**`
3) Publish site bundle into DT repo → `eudr-dmi-gil-digital-twin/docs/site/**`

## Documentation map

- [docs/governance/roles_and_workflow.md](docs/governance/roles_and_workflow.md)
- [ADOPTION_LOG.md](ADOPTION_LOG.md)
- [data_db/README.md](data_db/README.md)
- [docs/architecture/dependency_register.md](docs/architecture/dependency_register.md)
- [docs/architecture/decision_records/0001-report-pipeline-architecture.md](docs/architecture/decision_records/0001-report-pipeline-architecture.md)
- [docs/dependencies/README.md](docs/dependencies/README.md)
- [docs/dependencies/sources.md](docs/dependencies/sources.md)
- [docs/dependencies/flow.md](docs/dependencies/flow.md)
- [docs/operations/environment_setup.md](docs/operations/environment_setup.md)
- [docs/operations/minio_setup.md](docs/operations/minio_setup.md)
- [docs/operations/migration_runbook.md](docs/operations/migration_runbook.md)
- [docs/reports/README.md](docs/reports/README.md)
- [docs/reports/runbook_generate_aoi_report.md](docs/reports/runbook_generate_aoi_report.md)
- [scripts/migrate_from_private_eudr_dmi/README.md](scripts/migrate_from_private_eudr_dmi/README.md)

## Example AOI report (mandatory regression test)

This repository includes a zero-config, deterministic regression test that runs the full report pipeline end to end.

Default example AOI input:
- `aoi_json_examples/estonia_testland1.geojson`

Primary command (overwrites the existing `runs/example` output):

```sh
scripts/run_example_report_clean.sh
```

Notes:
- This is a mandatory full-stack regression test and must never use placeholder metrics.
- If `AOI_GEOJSON` is not set, the script uses `aoi_json_examples/estonia_testland1.geojson`.
- It bootstraps Hansen tiles into the external data plane (default: `/Users/server/data/eudr-dmi`).
- Override the external data root with `EUDR_DMI_DATA_ROOT=/path/to/data`.
- Override the Hansen URL template with `EUDR_DMI_HANSEN_URL_TEMPLATE`.
- Outputs are written under `out/site_bundle/aoi_reports` and evidence under `.tmp/evidence_example`.
- Hansen defaults in the example runner:
	- MinIO cache enabled when `HANSEN_MINIO_CACHE=1` (default: `1`).
	- Canopy threshold: `HANSEN_CANOPY_THRESHOLD` (default: `10`).
	- Reproject to projected CRS: `HANSEN_REPROJECT_TO_PROJECTED` (default: `1`).
	- Projected CRS: `HANSEN_PROJECTED_CRS` (default: `EPSG:6933`).

## AOI report regeneration contract

All AOI report generation must be preceded by the deterministic cleanup step:

```sh
scripts/clean_aoi_reports.sh
```

This script removes only derived AOI report outputs and is required before any regeneration to avoid stale artifacts.

Mandatory regression test:

```sh
scripts/run_example_report_clean.sh
```

### Use a different AOI GeoJSON (custom input)

```sh
AOI_GEOJSON="/absolute/path/to/my_aoi.geojson" scripts/run_example_report_clean.sh
```

Next: publish to DT
- Set `RUN_ID=example` and `STAGING_DIR=out/site_bundle/aoi_reports`, then run the DT publish script
	as described below.

## Publish latest AOI reports to the Digital Twin

This publishes only the two most recent AOI report runs to the DT repo and regenerates the AOI index.

1) Publish into the DT repo (auto-commit + push):

```sh
python tools/publish_latest_aoi_reports_to_dt.py \
	--dt-repo /Users/server/projects/eudr-dmi-gil-digital-twin \
	--dt-aoi-dir docs/site/aoi_reports \
	--source-dir out/site_bundle/aoi_reports \
	--keep 2
```

2) Verify navigation and links:

```sh
scripts/verify_dt_links.sh --dt-repo /Users/server/projects/eudr-dmi-gil-digital-twin
```

## Deterministic AOI reports publisher (exactly two runs)

This script publishes the two AOI run folders from:

- `out/site_bundle/aoi_reports/runs/`

into the DT repo path:

- `/Users/server/projects/eudr-dmi-gil-digital-twin/docs/site/aoi_reports/runs/`

It will abort unless **exactly two** run directories exist and both contain:

- `report.html`
- `aoi_report.json`

It cleans the DT AOI reports, copies the two runs, regenerates the AOI index, checks links, and **auto-commits + pushes** in the DT repo.

```sh
scripts/publish_aoi_reports_to_dt.sh
```

## Report V1 scaffold (JSON + HTML + PDF)

Generate a deterministic, audit-ready report bundle from AOI GeoJSON with optional KYC and analysis inputs:

```sh
python scripts/generate_report_v1.py \
	--run-id demo_2026-02-20 \
	--plot-id demo_plot_01 \
	--aoi-geojson /absolute/path/to/aoi.geojson \
	--kyc-json /absolute/path/to/kyc.json \
	--analysis-json /absolute/path/to/analysis.json \
	--out-dir out/reports
```

Output contract:

```text
out/reports/<run_id>/<plot_id>/
	report.json
	report.html
	report.pdf
	manifest.sha256
```

## Governance, Inspection & DAO Entry Points

This repository is the authoritative implementation.
Stakeholder Q/A, proposals, and acceptance criteria are governed by the DTE instructions.
Developers should use these links to interpret DAO proposals correctly.

- Digital Twin DTE Instructions (Canonical): https://github.com/GeorgeMadlis/eudr-dmi-gil-digital-twin/blob/main/docs/dte_instructions.md
- Digital Twin Inspection Index: https://github.com/GeorgeMadlis/eudr-dmi-gil-digital-twin/blob/main/docs/INSPECTION_INDEX.md

## Relationship to the portal

Inspectable HTML views and procedural-DAO governance interfaces are published separately in the eudr-dmi-gil-digital-twin repository.

https://github.com/GeorgeMadlis/eudr-dmi-gil-digital-twin

---

## Attribution & Intent

This work has been developed on the author’s personal time and is
intended for use by the Single.Earth Foundation.  
No formal affiliation or endorsement is implied unless explicitly stated.

